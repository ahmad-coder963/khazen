<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>khazen AI 🧠</title>
    <link rel="icon" type="image/png" href="./61logov32nograd.png">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        
        --primary-dark: #073b3a;
        --primary-main: #0c6b58;
        --primary-light: #1fb28c;
        --background-main: #ffffff;
        --background-paper: #ffffff;
        --text-primary: #222222;
        --text-secondary: #555555;
        --text-light: #fbfbfb;
        --border-color: #eaecef;
        --font-family: "Tajawal", sans-serif;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--background-main);
        display: grid;
        place-items: center;
        height: 100vh;
        margin: 0;
        color: var(--text-primary);
      }

      .chat-container {
        background: var(--background-paper);
        width: 550px;
        max-width: 95%;
        height: 90vh;
        max-height: 800px;
        border-radius: 28px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.07),
          0 20px 50px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid var(--border-color);
      }

      .chat-header {
        background: linear-gradient(
          135deg,
          var(--primary-dark) 0%,
          var(--primary-main) 100%
        );
        color: var(--text-light);
        padding: 24px 20px;
        font-size: 22px;
        text-align: center;
        font-weight: 700;
        letter-spacing: 0.5px;
        flex-shrink: 0;
        border-bottom: 1px solid var(--primary-dark);
      }

      .chat-box {
        flex: 1;
        padding: 25px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      /* Custom Scrollbar for a premium feel */
      .chat-box::-webkit-scrollbar {
        width: 6px;
      }
      .chat-box::-webkit-scrollbar-track {
        background: transparent;
      }
      .chat-box::-webkit-scrollbar-thumb {
        background-color: #ccc;
        border-radius: 10px;
      }
      .chat-box::-webkit-scrollbar-thumb:hover {
        background-color: #aaa;
      }

      .message-wrapper {
        display: flex;
        flex-direction: column;
        max-width: 85%;
        animation: popIn 0.4s cubic-bezier(0.25, 1, 0.5, 1) forwards;
      }

      @keyframes popIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .sender {
        font-size: 13px;
        margin-bottom: 8px;
        font-weight: 700;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .message {
        padding: 14px 20px;
        border-radius: 20px;
        word-wrap: break-word;
        line-height: 1.6;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        font-size: 15px;
        font-weight: 500;
      }

      /* User Styles */
      .user-wrapper {
        align-self: flex-end;
      }
      .user-wrapper .sender {
        justify-content: flex-start; /* Correct for RTL */
      }
      .user-wrapper .message {
        background: linear-gradient(
          135deg,
          var(--primary-main) 0%,
          var(--primary-light) 100%
        );
        color: var(--text-light);
        border-bottom-left-radius: 5px;
      }

      /* Bot Styles */
      .bot-wrapper {
        align-self: flex-start;
      }
      .bot-wrapper .message {
        background: #eaecef; /* Slightly different from paper for contrast */
        color: var(--text-primary);
        border-bottom-right-radius: 5px;
      }

      .chat-input-container {
        padding: 15px 20px;
        border-top: 1px solid var(--border-color);
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px); /* Glassmorphism effect */
        flex-shrink: 0;
      }

      .input-wrapper {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .input-wrapper input {
        padding: 15px 18px;
        border-radius: 14px;
        border: 1px solid #dcdfe4;
        font-size: 15px;
        font-family: var(--font-family);
        width: 100%;
        box-sizing: border-box;
        transition: border-color 0.3s, box-shadow 0.3s;
        background: var(--background-paper);
      }

      .input-wrapper input:focus {
        outline: none;
        border-color: var(--primary-main);
        box-shadow: 0 0 0 4px rgba(12, 107, 88, 0.15);
      }

      .input-wrapper button {
        padding: 16px 20px;
        border: none;
        background: var(--primary-main);
        color: white;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 700;
        font-family: var(--font-family);
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
        box-shadow: 0 4px 15px rgba(12, 107, 88, 0.2);
      }

      .input-wrapper button:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(12, 107, 88, 0.3);
      }

      /* Typing indicator */
      .typing-indicator span {
        height: 9px;
        width: 9px;
        background-color: #b0b8c0;
        border-radius: 50%;
        display: inline-block;
        animation: bounce 1.4s infinite ease-in-out both;
      }
      .typing-indicator span:nth-of-type(2) {
        animation-delay: -0.32s;
      }
      .typing-indicator span:nth-of-type(3) {
        animation-delay: -0.16s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <!-- <div class="chat-header">ALKhazen AI 🧠</div> -->
       <div class="chat-header">
  <b>ALKhazen AI</b> <img src="./61logov32nograd.png" alt="ALKhazen AI Logo" style="height: 50px; vertical-align: middle; margin-right: 10px;" /> <img src="./images-removebg-preview (1).png" alt="Verified Badge" style="height: 50px; vertical-align: middle;  justify-content: flex-start;" />
</div>
      <div class="chat-box" id="chatBox">
        <div class="message-wrapper bot-wrapper">
          <div class="sender">🤖 المساعد الذكي</div>
          <div class="message">
            أهلاً بك. أنا هنا لمساعدتك، كيف يمكنني خدمتك اليوم؟
          </div>
        </div>
      </div>
      <div class="chat-input-container">
        <div class="input-wrapper">
          <input type="text" id="customer" placeholder="رقم العميل (اختياري)" />
          <input type="text" id="question" placeholder="اكتب سؤالك هنا..." />
          <button id="sendBtn">إرسال</button>
        </div>
      </div>
    </div>

    <script>
      const WEBHOOK_URL =
        "http://localhost:5678/webhook-test/3205deea-d5ae-4df2-9948-47a40b0ba743";
      const chatBox = document.getElementById("chatBox");
      const sendBtn = document.getElementById("sendBtn");
      const customerInput = document.getElementById("customer");
      const questionInput = document.getElementById("question");

      function addMessage(text, sender) {
        const wrapper = document.createElement("div");
        wrapper.classList.add("message-wrapper", `${sender}-wrapper`);

        const senderLabel = document.createElement("div");
        senderLabel.classList.add("sender");
        senderLabel.innerText =
          sender === "user" ? "👤 أنت" : "🤖 المساعد الذكي";

        const msgDiv = document.createElement("div");
        msgDiv.classList.add("message");
        msgDiv.innerHTML = text;

        wrapper.appendChild(senderLabel);
        wrapper.appendChild(msgDiv);
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function showTypingIndicator() {
        const indicatorHTML = `
        <div class="message-wrapper bot-wrapper" id="typingIndicator">
          <div class="sender">🤖 المساعد الذكي</div>
          <div class="message typing-indicator">
            <span></span><span></span><span></span>
          </div>
        </div>
      `;
        chatBox.insertAdjacentHTML("beforeend", indicatorHTML);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function hideTypingIndicator() {
        const indicator = document.getElementById("typingIndicator");
        if (indicator) {
          indicator.remove();
        }
      }

      async function sendMessage() {
        const customer = customerInput.value.trim();
        const question = questionInput.value.trim();

        if (!question) {
          alert("يرجى كتابة سؤالك قبل الإرسال.");
          return;
        }

        addMessage(question, "user");
        questionInput.value = "";
        showTypingIndicator();

        try {
          const response = await fetch(WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ customer, question }),
          });

          hideTypingIndicator();

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          const botText = data.output;

          if (botText && typeof botText === "string") {
            addMessage(botText, "bot");
          } else {
            addMessage("❌ لم يتم العثور على محتوى صالح في الرد.", "bot");
          }
        } catch (err) {
          hideTypingIndicator();
          addMessage(
            "❌ حدث خطأ أثناء الاتصال بالخادم. يرجى المحاولة مرة أخرى.",
            "bot"
          );
          console.error("Webhook connection error:", err);
        }
      }

      sendBtn.addEventListener("click", sendMessage);
      questionInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });
      customerInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage();
      });
    </script>
  </body>
</html>
